<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배양 상태창</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .units-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .unit {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            width: 200px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .unit-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .step-button {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #dcdcdc;
            color: black;
            font-weight: bold;
        }
        .step-button.active {
            background-color: #4caf50;
            color: white;
        }
        .date-time {
            margin: 10px 0;
            text-align: center;
        }
        .date-time button {
            margin-right: 10px;
        }
        .display-date-time {
            display: inline-block;
            margin-left: 10px;
        }
        .arrow {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid #000;
            margin: 0 auto;
        }
        #date-time-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border: 1px solid #ccc;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        #reset-button {
            background-color: red;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            margin-top: 20px;
        }
        .sub-options {
            margin-left: 10px;
        }
        .sub-checkbox {
            margin-left: 20px;
        }
    </style>
</head>
<body>

<h1>미생물 배양 상태창</h1>

<div class="units-container">
    <!-- 1호기 -->
    <div class="unit" id="unit-1">
        <div class="unit-title">1호기</div>
        <div class="step">
            <button id="step1-1" class="step-button" onclick="toggleStep('step1-1', 1)">물공급</button>
        </div>
        <div class="arrow"></div>
        <div class="date-time date-time-top">
            <button type="button" onclick="openDateTimePicker('display-date-time-1-1')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-1-1"></div>
        </div>
        <div class="step">
            <button id="step2-1" class="step-button" onclick="toggleStep('step2-1', 1)">멸균(배지)</button>
        </div>
        <div class="date-time date-time-bottom">
            <button type="button" onclick="openDateTimePicker('display-date-time-2-1')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-2-1"></div>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step3-1" class="step-button" onclick="toggleStep('step3-1', 1)">냉각(배양액)</button>
        </div>
        <div class="arrow"></div>
        <div class="date-time date-time-top">
            <button type="button" onclick="openDateTimePicker('display-date-time-3-1')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-3-1"></div>
        </div>
        <div class="step">
            <button id="step4-1" class="step-button" onclick="toggleStep('step4-1', 1)">배양(종균)</button>
            <div class="sub-options">
                <label><input type="checkbox" id="sub1-1" class="sub-checkbox" onclick="toggleSubOption('sub1-1', 1)"> 멸균(라인, 샘플)</label>
                <label><input type="checkbox" id="sub2-1" class="sub-checkbox" onclick="toggleSubOption('sub2-1', 1)"> 샘플 채취</label>
            </div>
        </div>
        <div class="date-time date-time-bottom">
            <button type="button" onclick="openDateTimePicker('display-date-time-4-1')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-4-1"></div>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step5-1" class="step-button" onclick="toggleStep('step5-1', 1)">저장고 이송</button>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step6-1" class="step-button" onclick="toggleStep('step6-1', 1)">물세척</button>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step7-1" class="step-button" onclick="toggleStep('step7-1', 1)">종료(OFF)</button>
        </div>
    </div>

    <!-- 2호기 -->
    <div class="unit" id="unit-2">
        <div class="unit-title">2호기</div>
        <div class="step">
            <button id="step1-2" class="step-button" onclick="toggleStep('step1-2', 2)">물공급</button>
        </div>
        <div class="arrow"></div>
        <div class="date-time date-time-top">
            <button type="button" onclick="openDateTimePicker('display-date-time-1-2')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-1-2"></div>
        </div>
        <div class="step">
            <button id="step2-2" class="step-button" onclick="toggleStep('step2-2', 2)">멸균(배지)</button>
        </div>
        <div class="date-time date-time-bottom">
            <button type="button" onclick="openDateTimePicker('display-date-time-2-2')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-2-2"></div>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step3-2" class="step-button" onclick="toggleStep('step3-2', 2)">냉각(배양액)</button>
        </div>
        <div class="arrow"></div>
        <div class="date-time date-time-top">
            <button type="button" onclick="openDateTimePicker('display-date-time-3-2')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-3-2"></div>
        </div>
        <div class="step">
            <button id="step4-2" class="step-button" onclick="toggleStep('step4-2', 2)">배양(종균)</button>
            <div class="sub-options">
                <label><input type="checkbox" id="sub1-2" class="sub-checkbox" onclick="toggleSubOption('sub1-2', 2)"> 멸균(라인, 샘플)</label>
                <label><input type="checkbox" id="sub2-2" class="sub-checkbox" onclick="toggleSubOption('sub2-2', 2)"> 샘플 채취</label>
            </div>
        </div>
        <div class="date-time date-time-bottom">
            <button type="button" onclick="openDateTimePicker('display-date-time-4-2')">날짜/시간</button>
            <div class="display-date-time" id="display-date-time-4-2"></div>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step5-2" class="step-button" onclick="toggleStep('step5-2', 2)">저장고 이송</button>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step6-2" class="step-button" onclick="toggleStep('step6-2', 2)">물세척</button>
        </div>
        <div class="arrow"></div>
        <div class="step">
            <button id="step7-2" class="step-button" onclick="toggleStep('step7-2', 2)">종료(OFF)</button>
        </div>
    </div>
</div>

<button id="reset-button" onclick="resetAll()">초기화</button>

<div id="date-time-popup">
    <h2>날짜/시간 설정</h2>
    <input type="datetime-local" id="date-time-input">
    <button onclick="setDateTime()">설정</button>
    <button onclick="closeDateTimePicker()">닫기</button>
</div>

<script>
    // Step 버튼의 상태를 토글하는 함수
    function toggleStep(buttonId, unitNumber) {
        const buttons = document.querySelectorAll(`#unit-${unitNumber} .step-button`);
        buttons.forEach(btn => {
            if (btn.id !== buttonId) {
                btn.classList.remove('active');
            }
        });
        const clickedButton = document.getElementById(buttonId);
        clickedButton.classList.toggle('active');
        saveState();
    }

    // Sub-checkbox 상태를 토글하는 함수
    function toggleSubOption(checkboxId, unitNumber) {
        saveState();
    }

    // 날짜/시간 선택기 열기
    let currentElementId = null;

    function openDateTimePicker(elementId) {
        currentElementId = elementId;
        document.getElementById('date-time-popup').style.display = 'block';
    }

    // 날짜/시간 선택기 닫기
    function closeDateTimePicker() {
        document.getElementById('date-time-popup').style.display = 'none';
    }

    // 날짜/시간 설정
    function setDateTime() {
        const dateTime = document.getElementById('date-time-input').value;
        if (currentElementId) {
            document.getElementById(currentElementId).innerText = dateTime;
            saveState();
            closeDateTimePicker();
        }
    }

    // 상태 저장
    function saveState() {
        const units = document.querySelectorAll('.unit');
        units.forEach(unit => {
            const unitNumber = unit.id.split('-')[1];
            const buttons = unit.querySelectorAll('.step-button');
            buttons.forEach(button => {
                localStorage.setItem(`${unitNumber}-${button.id}`, button.classList.contains('active'));
            });
            const checkboxes = unit.querySelectorAll('.sub-checkbox');
            checkboxes.forEach(checkbox => {
                localStorage.setItem(`${unitNumber}-${checkbox.id}`, checkbox.checked);
            });
            const dateTimes = unit.querySelectorAll('.display-date-time');
            dateTimes.forEach(dateTime => {
                localStorage.setItem(`${unitNumber}-${dateTime.id}`, dateTime.innerText);
            });
        });
    }

    // 상태 로드
    function loadState() {
        const units = document.querySelectorAll('.unit');
        units.forEach(unit => {
            const unitNumber = unit.id.split('-')[1];
            const buttons = unit.querySelectorAll('.step-button');
            buttons.forEach(button => {
                const isActive = localStorage.getItem(`${unitNumber}-${button.id}`) === 'true';
                if (isActive) {
                    button.classList.add('active');
                }
            });
            const checkboxes = unit.querySelectorAll('.sub-checkbox');
            checkboxes.forEach(checkbox => {
                const isChecked = localStorage.getItem(`${unitNumber}-${checkbox.id}`) === 'true';
                checkbox.checked = isChecked;
            });
            const dateTimes = unit.querySelectorAll('.display-date-time');
            dateTimes.forEach(dateTime => {
                const savedDateTime = localStorage.getItem(`${unitNumber}-${dateTime.id}`);
                if (savedDateTime) {
                    dateTime.innerText = savedDateTime;
                }
            });
        });
    }

    // 모든 설정 초기화
    function resetAll() {
        localStorage.clear();
        location.reload();
    }

    // 페이지 로드 시 상태 로드
    window.onload = loadState;
</script>

</body>
</html>
